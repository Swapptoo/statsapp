{% extends 'StatsAppBundle:Base:index.html.twig' %}

{% block pagetitle %}{{ 'Application Statistics'|trans }}{% endblock %}

{% block content %}
    {% if data|length %}
        <div class="post-list group">
            <div class="post-row">
            {% if data.version %}
                <div class="post text-center">
                    <h2 class="post-title">{{ 'Installed Versions'|trans }}</h2>
                    <canvas id="mauticChartVersion" width="400" height="400"></canvas>
                </div>
            {% endif %}
            {% if data.phpVersion %}
                <div class="post text-center">
                    <h2 class="post-title">{{ 'PHP Versions'|trans }}</h2>
                    <canvas id="mauticChartPhp" width="400" height="400"></canvas>
                </div>
            {% endif %}
        </div>
    {% else %}
        <div class="alert alert-info">{{ 'No statistics for Mautic are available'|trans }}</div>
    {% endif %}
{% endblock %}

{% block bodyJavaScript %}
    {{ parent() }}
    <script src="{{ asset('js/Chart.min.js') }}"></script>

    {% if data|length %}
        <script type="text/javascript">
            jQuery(document).ready(function ($) {
                {% if data.version %}
                    var appData = [{% for version, count in data.version %}{value: {{ count }}, label: "{{ version }}", color: "{{ chart_color() }}"}{% if not loop.last %},{% endif %}{% endfor %}]
                    var ctxApp = document.getElementById('mauticChartVersion').getContext('2d');
                    var appChart = new Chart(ctxApp).Doughnut(appData);
                {% endif %}
                {% if data.phpVersion %}
                    var phpData = [{% for version, count in data.phpVersion %}{value: {{ count }}, label: "{{ version }}", color: "{{ chart_color() }}"}{% if not loop.last %},{% endif %}{% endfor %}]
                    var ctxPhp = document.getElementById('mauticChartPhp').getContext('2d');
                    var phpChart = new Chart(ctxPhp).Doughnut(phpData);
                {% endif %}
            });
        </script>
    {% endif %}
{% endblock %}
